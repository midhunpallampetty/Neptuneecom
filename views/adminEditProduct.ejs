<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Evara Dashboard</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="" />
    <meta property="og:type" content="" />
    <meta property="og:url" content="" />
    <meta property="og:image" content="" />
    <!-- Favicon -->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="imgs/theme/favicon.svg"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" integrity="sha384-eiETumQFzuy48lHrO9obg9e8a7+3wF3pSp3yUp0H4V5Z6Yb6UKOqYme7aA8LXdIj" crossorigin="anonymous">
<!-- Include Cropper.js script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js" integrity="sha384-l9k5/KdRf+IkLmlnL49b6eAMh+I1Z5inZIUMYdY22KbxqE0TAF/RBwxjxjGq+tF5" crossorigin="anonymous"></script>
    <!-- Template CSS -->
    <link href="/css2/main.css" rel="stylesheet" type="text/css" />
  </head>

  <body>
    <div class="screen-overlay"></div>
    <aside class="navbar-aside" id="offcanvas_aside">
      <div class="aside-top">
        <a href="index.html" class="brand-wrap">
          <img
            src="/imgs/logo.png"
            class="logo"
            alt="Evara Dashboard"
          />
        </a>
        <div>
          <button class="btn btn-icon btn-aside-minimize">
            <i class="text-muted material-icons md-menu_open"></i>
          </button>
        </div>
      </div>
      <nav>
        <ul class="menu-aside">
          <li class="menu-item">
            <a class="menu-link" href="/adminDash">
              <i class="icon material-icons md-home"></i>
              <span class="text">Dashboard</span>
            </a>
          </li>
          <li class="menu-item has-submenu">
            <a class="menu-link" href="page-products-list.html">
              <i class="icon material-icons md-shopping_bag"></i>
              <span class="text">Products</span>
            </a>
       
          </li>
       
      
          <li class="menu-item has-submenu active">
            <a class="menu-link" href="/adminAddProduct">
              <i class="icon material-icons md-add_box"></i>
              <span class="text">Add product</span>
            </a>
           
          </li>
      
      
          <li class="menu-item">
            <a class="menu-link" href="page-brands.html">
              <i class="icon material-icons md-stars"></i>
              <span class="text">Brands</span>
            </a>
          </li>
          <li class="menu-item">
            <a class="menu-link" disabled href="#">
              <i class="icon material-icons md-pie_chart"></i>
              <span class="text">Statistics</span>
            </a>
          </li>
        </ul>
        <hr />
 
        <br />
        <br />
      </nav>
    </aside>
    <main class="main-wrap">
      <header class="main-header navbar">
        <div class="col-search">
          <form class="searchform">
            <div class="input-group">
              <input
                list="search_terms"
                type="text"
                class="form-control"
                placeholder="Search term"
              />
              <button class="btn btn-light bg" type="button">
                <i class="material-icons md-search"></i>
              </button>
            </div>
            <datalist id="search_terms">
              <option value="Products"></option>
              <option value="New orders"></option>
              <option value="Apple iphone"></option>
              <option value="Ahmed Hassan"></option>
            </datalist>
          </form>
        </div>
        <div class="col-nav">
          <button
            class="btn btn-icon btn-mobile me-auto"
            data-trigger="#offcanvas_aside"
          >
            <i class="material-icons md-apps"></i>
          </button>
          <ul class="nav">
            <li class="nav-item">
              <a class="nav-link btn-icon" href="#">
                <i class="material-icons md-notifications animation-shake"></i>
                <span class="badge rounded-pill">3</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link btn-icon darkmode" href="#">
                <i class="material-icons md-nights_stay"></i>
              </a>
            </li>
            <li class="nav-item">
              <a href="#" class="requestfullscreen nav-link btn-icon"
                ><i class="material-icons md-cast"></i
              ></a>
            </li>
            <li class="dropdown nav-item">
              <a
                class="dropdown-toggle"
                data-bs-toggle="dropdown"
                href="#"
                id="dropdownLanguage"
                aria-expanded="false"
                ><i class="material-icons md-public"></i
              ></a>
              <div
                class="dropdown-menu dropdown-menu-end"
                aria-labelledby="dropdownLanguage"
              >
                <a class="dropdown-item text-brand" href="#"
                  ><img src="imgs/theme/flag-us.png" alt="English" />English</a
                >
                <a class="dropdown-item" href="#"
                  ><img
                    src="imgs/theme/flag-fr.png"
                    alt="Français"
                  />Français</a
                >
                <a class="dropdown-item" href="#"
                  ><img src="imgs/theme/flag-jp.png" alt="Français" />日本語</a
                >
                <a class="dropdown-item" href="#"
                  ><img src="imgs/theme/flag-cn.png" alt="Français" />中国人</a
                >
              </div>
            </li>
            <li class="dropdown nav-item">
              <a
                class="dropdown-toggle"
                data-bs-toggle="dropdown"
                href="#"
                id="dropdownAccount"
                aria-expanded="false"
              >
                <img
                  class="img-xs rounded-circle"
                  src="imgs/people/avatar2.jpg"
                  alt="User"
              /></a>
              <div
                class="dropdown-menu dropdown-menu-end"
                aria-labelledby="dropdownAccount"
              >
                <a class="dropdown-item" href="#"
                  ><i class="material-icons md-perm_identity"></i>Edit
                  Profile</a
                >
                <a class="dropdown-item" href="#"
                  ><i class="material-icons md-settings"></i>Account Settings</a
                >
                <a class="dropdown-item" href="#"
                  ><i class="material-icons md-account_balance_wallet"></i
                  >Wallet</a
                >
                <a class="dropdown-item" href="#"
                  ><i class="material-icons md-receipt"></i>Billing</a
                >
                <a class="dropdown-item" href="#"
                  ><i class="material-icons md-help_outline"></i>Help center</a
                >
                <div class="dropdown-divider"></div>
                <a class="dropdown-item text-danger" href="#"
                  ><i class="material-icons md-exit_to_app"></i>Logout</a
                >
              </div>
            </li>
          </ul>
        </div>
      </header>
      <section class="content-main">
        <div class="row">
          <div class="col-9">
            <div class="content-header">
              <h2 class="content-title">Edit Product</h2>
              <div>
                <button
                  class="btn btn-light rounded font-sm mr-5 text-body hover-up"
                >
                  Save to draft
                </button>
                <button class="btn btn-md rounded font-sm hover-up">
                  Publich
                </button>
              </div>
            </div>
          </div>
          <form method="POST" action="/admin/edit" enctype="multipart/form-data" onsubmit="return validateForm()">
            <div class="col-lg-6">
              <div class="card mb-4">
                <div class="card-body">
                  <div class="mb-4">
                    <label for="product_title" class="form-label">Product title</label>
                    <input type="text" name="name" value="<%= product.name %>" placeholder="Type here" class="form-control" id="product_title">
                    <span class="error-message" id="name-error"></span>
                  </div>
                  <div class="mb-1">
                    <label for="brand" class="form-label">Product Brand</label>
                    <input type="text" name="brand" value="<%= product.brand %>" id="brand" placeholder="Type here" class="form-control">
                    <span class="error-message" id="brand-error"></span>
                  </div>
                  <div class="mb-4">
                    <label class="form-label">Category</label>
                    <select id="category" name="category" class="form-select">
                      <option value="" disabled>Select a category</option>
                      <% categories.forEach(category => { %>
                        <% if (category.listed) { %>
                          <option value="<%= category._id %>" <%= product.category.equals(category._id) ? 'selected' : '' %>>
                            <%= category.name %>
                          </option>
                        <% } %>
                      <% }); %>
                    </select>
                    <span class="error-message" id="category-error"></span>
                  </div>
                  <input type="hidden" name="productId" value="<%= product._id  %>">
                </div>
              </div>
              <!-- card end// -->
              <div class="card mb-4">
                <div class="card-body">
                  <div>
                    <label class="form-label">Description</label>
                    <textarea name="description" placeholder="Type here" class="form-control" rows="4"><%= product.description %></textarea>
                    <span class="error-message" id="description-error"></span>
                  </div>
                </div>
              </div>
              <div class="mb-1">
                <label for="stock" class="form-label">Stock</label>
                <input type="number" name="stock" id="stock" value="<%=  product.stock %>" placeholder="Enter stock quantity" class="form-control">
                <span class="error-message" id="stock-error"></span>
              </div>
<div class="mb-1">
                <label for="listprice" class="form-label">List Price</label>
                <input type="number" name="listprice" id="listprice" value="<%=  product.listprice %>" placeholder="$" class="form-control">
                <span class="error-message" id="listprice-error"></span>
              </div>
              <div class="mb-1">
                <label for="color" class="form-label">Color</label>
                <select id="color" name="color" class="form-select">
                  <option value="" disabled>Select a color</option>
                  <option value="Black" <%= product.color === "Black" ? "selected" : "" %>>Black</option>
                  <option value="Green" <%= product.color === "Green" ? "selected" : "" %>>Green</option>
                  <option value="Rainbow" <%= product.color === "Rainbow" ? "selected" : "" %>>Rainbow</option>
                  <option value="Brown" <%= product.color === "Brown" ? "selected" : "" %>>Brown</option>
                  <option value="White" <%= product.color === "White" ? "selected" : "" %>>White</option>
                  <option value="Red" <%= product.color === "Red" ? "selected" : "" %>>Red</option>
                  <option value="Grey" <%= product.color === "Grey" ? "selected" : "" %>>Grey</option>
                  <option value="Other" <%= product.color === "Other" ? "selected" : "" %>>Other</option>
                </select>
                <span class="error-message" id="color-error"></span>
              </div>
              
<div class="mb-1">
                <label for="weight" class="form-label">Weight</label>
                <input type="text" name="weight" id="weight" value="<%=  product.weight %>" placeholder="Enter weight" class="form-control">
                <span class="error-message" id="weight-error"></span>
              </div>
              <div class="mb-1">
                <label for="material" class="form-label">Material</label>
                <select id="material" name="material" class="form-select">
                  <option value="" disabled>Select a material</option>
                  <option value="Steel" <%= product.material === "Steel" ? "selected" : "" %>>Steel</option>
                  <option value="Wood" <%= product.material === "Wood" ? "selected" : "" %>>Wood</option>
                  <option value="Plastic" <%= product.material === "Plastic" ? "selected" : "" %>>Plastic</option>
                  <option value="Other" <%= product.material === "Other" ? "selected" : "" %>>Other</option>
                </select>
                <span class="error-message" id="material-error"></span>
              </div>
              <div class="form-group">
                <label for="newAdditionalImages">New Additional Images (optional)</label>
                <input type="file" name="additionalImages" id="newAdditionalImages" class="custom-file-input" multiple>
                <label class="custom-file-label" for="newAdditionalImages">Choose files</label>
              </div>
              <!-- card end// -->
              <% if (product.mainImage) { %>
                <img src="<%= product.mainImage %>" alt="Current Image" width="200">
              <% } %>
              <div id="cropContainer" style="display: none;width: 300px;height: 250px;">
                <label>Crop Image:</label>
                <div>
                  <img id="cropImage" src="" alt="Crop Preview" style="max-width: 40%;">
                </div>
                <button type="button" style="background-color: #007BFF; margin-top: 10px; border: none; border-radius: 10px; width: 100px; height: 50px; font-size: medium;" id="applyCrop">Apply Crop</button>
              </div>
              <!-- Upload New Main Image (if needed) -->
              <div class="form-group">
                <label for="newMainImage">New Main Image (optional)</label>
                <input type="file" name="mainImage" id="newMainImage" class="custom-file-input">
                <label class="custom-file-label" for="newMainImage">Choose file</label>
              </div>
              
              <!-- Your existing form fields go here -->

<!-- Your existing form fields go here -->

<!-- Your existing form fields go here -->





              <!-- Upload New Additional Images (if needed) -->
              
              
              <!-- card end// -->
            </div>
            <div class="col-lg-3">
              <div class="card mb-4">
                <div class="card-body">
                  <div class="mb-4">
                    $<label class="form-label">Price</label>
                    <input name="price" type="text" value="<%= product.price %>" placeholder="Type here" class="form-control" id="price">
                    <span class="error-message" id="price-error"></span>
                  </div>
                  <button
                    type="submit"
                    style="
                      background-color: green;
                      color: white;
                      border: none;
                      width: 230px;
                      height: 35px;
                      border-radius: 15px;
                    "
                  >
                    Submit
                  </button>
                </div>
              </div>
            </div>
          </form>
          
          <style>
            .error-message{
                color: red;
            }
            /* Style the custom file input container */
.form-group {
  position: relative;
}

/* Style the custom file input to be hidden and positioned over the label text */
.custom-file-input {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  z-index: 2;
}

/* Style the custom file label to appear as a button */
.custom-file-label {
  background-color: #3498db; /* Background color for the label */
  color: #fff; /* Text color for the label */
  padding: 8px 12px; /* Add padding to the label */
  border-radius: 5px; /* Add rounded corners to the label */
  cursor: pointer; /* Change the cursor to a pointer when hovering over the label */
}

          </style>
        </div>
      </section>
      <footer class="main-footer font-xs">
        <div class="row pb-30 pt-15">
          <div class="col-sm-6">
            <script>
              document.write(new Date().getFullYear());
            </script>
            ©, Evara - HTML Ecommerce Template .
          </div>
          <div class="col-sm-6">
            <div class="text-sm-end">All rights reserved</div>
          </div>
        </div>
      </footer>
    </main>
    <script>
      function validateForm() {
        // Reset error messages
        resetErrorMessages();
    
        // Flag to check if form is valid
        let isValid = true;
    
        // Product title validation
        const name = document.getElementById('product_title').value.trim();
        if (!/^[a-zA-Z ]+$/.test(name) || /^\d+$/.test(name)) {
          displayError('name', 'Product title should contain only characters and spaces.');
          isValid = false;
        }
    
        // Product brand validation
        const brand = document.getElementById('brand').value.trim();
        if (!/^[a-zA-Z ]+$/.test(brand) || /^\d+$/.test(brand)) {
          displayError('brand', 'Product brand should contain only characters and spaces.');
          isValid = false;
        }
    
        // Description validation
        const description = document.querySelector('textarea[name="description"]').value.trim();
        if (description.length < 10 || /\s{2,}|\d+|[!@#$%^&*(),.?":{}|<>]/.test(description)) {
          displayError('description', 'Description should be at least 10 characters and contain no numbers or special characters.');
          isValid = false;
        }
    
        // Category validation
        const category = document.getElementById('category').value;
        if (!category) {
          displayError('category', 'Please select a category.');
          isValid = false;
        }
    
        // Selling Price validation
        const price = document.getElementById('price').value.trim();
        if (!price) {
          displayError('price', 'Selling Price is required.');
          isValid = false;
        }
    
        // Material validation
        const material = document.getElementById('material').value;
        if (!material) {
          displayError('material', 'Material must be selected.');
          isValid = false;
        }
    
        // Weight validation
        const weight = document.getElementById('weight').value.trim();
        if (!/^\d+$/.test(weight)) {
          displayError('weight', 'Weight must be provided in numbers only.');
          isValid = false;
        }
    
        // Stock validation
        const stock = document.getElementById('stock').value.trim();
        if (!/^[1-9]\d*$/.test(stock)) {
          displayError('stock', 'Stock quantity must be 1 or greater.');
          isValid = false;
        }
    
        // List Price validation
        const listPrice = document.getElementById('listprice').value.trim();
        if (!listPrice) {
          displayError('listprice', 'List Price is required.');
          isValid = false;
        }
    
        // Color validation
        const color = document.getElementById('color').value;
        if (!color) {
          displayError('color', 'Please select a color.');
          isValid = false;
        }
    
        // Main Image validation
        const mainImage = document.getElementById('newMainImage').value.trim();
        if (mainImage && !/\.(png|jpg|gif|webp)$/.test(mainImage.toLowerCase())) {
          displayError('newMainImage', 'Main Product Image must be in PNG, JPG, GIF, or WEBP format.');
          isValid = false;
        }
    
        // Additional Images validation
        const additionalImages = document.getElementById('newAdditionalImages').files;
        for (const file of additionalImages) {
          if (!/\.(png|jpg|gif|webp)$/.test(file.name.toLowerCase())) {
            displayError('newAdditionalImages', 'Additional Product Images must be in PNG, JPG, GIF, or WEBP format.');
            isValid = false;
            break;
          }
        }
    
        // Submit the form if it's valid
        return isValid;
      }
    
      // Helper function to display error messages
      function displayError(field, message) {
        document.getElementById(`${field}-error`).innerText = message;
        setTimeout(() => {
          resetErrorMessages();
        }, 5000);
      }
    
      // Helper function to reset error messages
      function resetErrorMessages() {
        const errorMessages = document.getElementsByClassName('error-message');
        for (const errorMessage of errorMessages) {
          errorMessage.innerText = '';
        }
      }



      document.addEventListener('DOMContentLoaded', function () {
  const input = document.getElementById('mainImage');
  const image = document.getElementById('cropImage');
  const container = document.getElementById('cropContainer');
  const applyCropBtn = document.getElementById('applyCrop');
  let cropper;

  input.addEventListener('change', function () {
    const file = this.files[0];

    if (file) {
      // Destroy the existing Cropper instance if it exists
      if (cropper) {
        cropper.destroy();
      }

      const reader = new FileReader();

      reader.onload = function (e) {
        image.src = e.target.result;
        container.style.display = 'block';

        // Initialize Cropper.js
        cropper = new Cropper(image, {
          aspectRatio: 1, // Set your desired aspect ratio
          viewMode: 2,    // Set your desired view mode
        });
      };

      reader.readAsDataURL(file);
    }
  });

  applyCropBtn.addEventListener('click', function () {
    if (cropper) {
      // Get the cropped data (base64 format)
      const croppedData = cropper.getCroppedCanvas().toDataURL();

      // Update the mainImage input value with the cropped data
      document.getElementById('mainImage').value = croppedData;

      // Hide the crop container
      container.style.display = 'none';
    }
  });
});

    </script>
    

    
    <script src="/js2/vendors/jquery-3.6.0.min.js"></script>
    <script src="/js2/vendors/bootstrap.bundle.min.js"></script>
    <script src="/js2/vendors/select2.min.js"></script>
    <script src="/js2/vendors/perfect-scrollbar.js"></script>
    <script src="/js2/vendors/jquery.fullscreen.min.js"></script>
    <!-- Main Script -->
    <script src="/js2/main.js" type="text/javascript"></script>
  </body>
</html>
